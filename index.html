<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–°–æ—Ü-–†–µ–π—Ç–∏–Ω–≥ –ê—Ä–µ–Ω–∞</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg:#0f0f2e;
      --card:#1f115a;
      --accent:#9b79ff;
      --radius:12px;
      --shadow:0 25px 60px -10px rgba(155,121,255,.35);
      --text:#eef;
    }
    *{box-sizing:border-box;}
    body {
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont;
      background: linear-gradient(135deg,var(--bg), #0f0f5a);
      color: var(--text);
    }
    .container {
      max-width: 1000px;
      margin:0 auto;
      padding:16px 12px 60px;
    }
    .header {
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      justify-content: space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .title {
      font-size:2rem;
      margin:0;
      background: linear-gradient(90deg,#ff85d6,#8c9bff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .sub { font-size:.9rem; margin-top:4px; color:#ccc; }
    .grid {
      display:grid;
      gap:18px;
      grid-template-columns: repeat(auto-fit,minmax(300px,1fr));
    }
    .card {
      background: rgba(30,20,80,.92);
      border:2px solid rgba(155,121,255,.6);
      border-radius: var(--radius);
      padding:16px 20px 20px;
      position:relative;
      box-shadow: var(--shadow);
      overflow:hidden;
      transition: .3s;
    }
    .card:hover { transform: translateY(-2px); }
    .card-header {
      display:flex;
      justify-content: space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .badge {
      padding:6px 14px;
      background: linear-gradient(135deg,#ff85d6,#8c9bff);
      border-radius:999px;
      font-size:.65rem;
      font-weight:700;
      text-transform:uppercase;
    }
    .stats { display:grid; gap:6px; margin-bottom:8px; }
    .row { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px solid rgba(255,255,255,.07); }
    .btn {
      background: linear-gradient(135deg,#8c9bff,#ff85d6);
      border:none;
      padding:10px 14px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      color:#fff;
      position:relative;
      overflow:hidden;
      transition:transform .2s;
    }
    .btn:active { transform:scale(.95); }
    .small { font-size:.75rem; color:#bbb; }
    .leaderboard { display:flex; flex-direction:column; gap:6px; }
    .entry {
      background: rgba(255,255,255,.05);
      padding:10px;
      border-radius:8px;
      display:flex;
      justify-content:space-between;
      font-size:.85rem;
    }
    .currency {
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:6px;
    }
    .stars {
      display:flex;
      gap:4px;
      font-size:1.1rem;
    }
    .pulse {
      animation:pulse .6s ease;
    }
    @keyframes pulse {
      0%{ transform:scale(1); }
      50%{ transform:scale(1.05); }
      100%{ transform:scale(1); }
    }
    .toast {
      position:fixed;
      bottom:16px;
      right:16px;
      background: rgba(255,255,255,.06);
      padding:12px 18px;
      border:1px solid var(--accent);
      border-radius:9px;
      backdrop-filter: blur(6px);
      font-weight:600;
      z-index:999;
    }
    .wheel-wrapper {
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
    }
    .wheel {
      width:160px;
      height:160px;
      border-radius:50%;
      position:relative;
      background: conic-gradient(
        #7c5cff 0deg 60deg,
        #ff85d6 60deg 120deg,
        #5bf5ff 120deg 180deg,
        #ffda6b 180deg 240deg,
        #ffa5a5 240deg 300deg,
        #d19bff 300deg 360deg
      );
      border:6px solid rgba(255,255,255,.08);
      display:flex;
      justify-content:center;
      align-items:center;
      font-size:0;
      transition: transform 4s cubic-bezier(.17,.67,.83,.67);
      box-shadow:0 20px 60px -10px rgba(155,121,255,.5);
    }
    .pointer {
      position:absolute;
      top:-8px;
      font-size:28px;
      color:#fff;
      text-shadow:0 0 12px rgba(255,255,255,.6);
    }
    .slot { display:flex; gap:10px; margin-bottom:6px; }
    .reel {
      flex:1;
      background: rgba(255,255,255,.05);
      border-radius:8px;
      padding:14px;
      font-size:2.2rem;
      text-align:center;
      min-height:70px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .profile-top {display:flex; gap:12px; align-items:center; flex-wrap:wrap;}
    .title-small { font-size:1rem; font-weight:700; margin:0; }
    .pill { background: rgba(255,255,255,.08); padding:4px 12px; border-radius:999px; font-size:.6rem; margin-left:6px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 class="title">üî• –°–æ—Ü-–†–µ–π—Ç–∏–Ω–≥ –ê—Ä–µ–Ω–∞</h1>
        <div class="sub">–¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ Telegram, —Ä–µ–π—Ç–∏–Ω–≥, –∑–≤—ë–∑–¥–æ—á–∫–∏, –∫–æ–ª–µ—Å–æ –∏ —Å–ª–æ—Ç ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –æ–∫–Ω–µ.</div>
      </div>
      <div class="currency">
        <div class="small">–ó–≤—ë–∑–¥–æ—á–∫–∏:</div>
        <div class="stars" id="star-display">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ <span id="star-count">0</span></div>
      </div>
    </div>

    <div class="grid">
      <!-- –ø—Ä–æ—Ñ–∏–ª—å -->
      <div class="card" id="profile-card">
        <div class="card-header">
          <div>
            <div class="profile-top">
              <div>
                <div class="title-small" id="user-name">Anon</div>
                <div class="small" id="user-id">Telegram ID: ‚Äî</div>
              </div>
              <div class="pill" id="title-badge">–ù–æ–≤–∏—á–æ–∫</div>
            </div>
          </div>
          <div class="badge" id="prestige-badge">x1.00</div>
        </div>
        <div class="stats" id="profile-stats">
          <!-- rows injected -->
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn" id="daily-btn">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ /daily</button>
          <button class="btn" id="prestige-btn">–ü—Ä–µ—Å—Ç–∏–∂</button>
          <button class="btn" id="refresh-btn">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
        <div class="small" style="margin-top:8px;">–ü—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Telegram. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.</div>
      </div>

      <!-- –∫–æ–ª–µ—Å–æ -->
      <div class="card">
        <div class="card-header">
          <div>–ö–æ–ª–µ—Å–æ —É–¥–∞—á–∏</div>
          <div class="small">–†–∞–∑ –≤ –¥–µ–Ω—å —à–∞–Ω—Å –Ω–∞ –±–æ–Ω—É—Å</div>
        </div>
        <div class="wheel-wrapper">
          <div class="pointer">‚ñº</div>
          <div id="wheel" class="wheel"></div>
          <div class="small" id="wheel-result">–ñ–º–∏ –∏ –ø–æ–ª—É—á–∞–π!</div>
          <button class="btn" id="spin-wheel">–ö—Ä—É—Ç–∏—Ç—å</button>
        </div>
      </div>

      <!-- —Å–ª–æ—Ç -->
      <div class="card">
        <div class="card-header">
          <div>–°–ª–æ—Ç-–º–∞—à–∏–Ω–∞</div>
          <div class="small">–ü–æ–ø—Ä–æ–±—É–π –≤—ã–∏–≥—Ä–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥</div>
        </div>
        <div class="slot">
          <div class="reel" id="r1">?</div>
          <div class="reel" id="r2">?</div>
          <div class="reel" id="r3">?</div>
        </div>
        <div class="small" id="slot-result">–ù–∞–∂–º–∏ &quot;–ò–≥—Ä–∞—Ç—å&quot;.</div>
        <button class="btn" id="spin-slot">–ò–≥—Ä–∞—Ç—å</button>
      </div>

      <!-- –ª–∏–¥–µ—Ä–±–æ—Ä–¥ -->
      <div class="card">
        <div class="card-header">
          <div>–õ–æ–∫–∞–ª—å–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥</div>
          <div class="small">–°–æ—Ä–µ–≤–Ω—É–π—Å—è –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É</div>
        </div>
        <div class="leaderboard" id="leaderboard"></div>
        <div style="margin-top:8px;">
          <button class="btn" id="clear-lb">–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ø</button>
        </div>
      </div>
    </div>

    <div style="margin-top:24px;">
      <div class="card">
        <div class="card-header">
          <div>FAQ / –ö–∞–∫ –∏–≥—Ä–∞—Ç—å</div>
        </div>
        <div class="small">
          <ul>
            <li>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –∏–∑ Telegram WebApp. –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å –≤–Ω–µ Telegram ‚Äî –∏–≥—Ä–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ.</li>
            <li>/daily ‚Äî —Ä–∞–∑ –≤ 24 —á–∞—Å–∞ —Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞, –≤–ª–∏—è–µ—Ç —Å—Ç—Ä–∏–∫ –∏ –ø—Ä–µ—Å—Ç–∏–∂.</li>
            <li>–ü—Ä–µ—Å—Ç–∏–∂: –ø—Ä–∏ ‚â•1000 —Ä–µ–π—Ç–∏–Ω–≥ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –¥–æ 100, –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–∞—Å—Ç—ë—Ç.</li>
            <li>–ö–æ–ª–µ—Å–æ –∏ —Å–ª–æ—Ç –¥–∞—é—Ç –±–æ–Ω—É—Å—ã: —Ä–µ–π—Ç–∏–Ω–≥, –∑–≤—ë–∑–¥–æ—á–∫–∏, –º–Ω–æ–∂–∏—Ç–µ–ª–∏.</li>
            <li>–õ–∏–¥–µ—Ä–±–æ—Ä–¥ –ª–æ–∫–∞–ª—å–Ω—ã–π, –Ω–æ –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–π —á–µ—Ä–µ–∑ API.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div id="toast-container"></div>

  <script>
    const API_BASE = ""; // –µ—Å–ª–∏ API –∂–∏–≤—ë—Ç –Ω–∞ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ, –∏–ª–∏ —É–∫–∞–∂–∏ –ø–æ–ª–Ω—ã–π URL, –Ω–∞–ø—Ä–∏–º–µ—Ä https://your-backend.domain

    // Toast
    function toast(msg) {
      const t = document.createElement("div");
      t.className = "toast";
      t.textContent = msg;
      document.getElementById("toast-container").appendChild(t);
      setTimeout(() => t.remove(), 2200);
    }

    // Telegram WebApp
    const isTelegram = !!window.Telegram?.WebApp;
    if (isTelegram) {
      window.Telegram.WebApp.ready();
    }

    // State
    let profile = {
      user_id: null,
      username: "Anon",
      rating: 100,
      title: "–ù–æ–≤–∏—á–æ–∫",
      streak: 0,
      prestige_multiplier: 1.0,
      prestige_level: 0,
      stars: 0,
      last_daily: null,
    };
    const LB_KEY = "sr_arena_leaderboard_v1";

    function saveLocalLeaderboard(arr) {
      localStorage.setItem(LB_KEY, JSON.stringify(arr));
    }
    function loadLocalLeaderboard() {
      try {
        return JSON.parse(localStorage.getItem(LB_KEY) || "[]");
      } catch { return []; }
    }
    function updateLocalLeaderboard() {
      const lb = loadLocalLeaderboard();
      const existing = lb.find(e => e.user_id === profile.user_id);
      if (existing) {
        existing.rating = profile.rating;
        existing.updated = Date.now();
      } else {
        lb.push({ user_id: profile.user_id, username: profile.username, rating: profile.rating, updated: Date.now() });
      }
      lb.sort((a,b)=>b.rating - a.rating);
      saveLocalLeaderboard(lb.slice(0, 20));
      renderLeaderboard();
    }

    function renderLeaderboard() {
      const container = document.getElementById("leaderboard");
      container.innerHTML = "";
      const lb = loadLocalLeaderboard();
      if (!lb.length) {
        container.innerHTML = "<div class='small'>–¢–æ–ø –ø—É—Å—Ç ‚Äî –∏–≥—Ä–∞–π —á—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å.</div>";
        return;
      }
      lb.forEach((e,i)=>{
        const div = document.createElement("div");
        div.className = "entry";
        div.innerHTML = `<div>${i+1}. ${e.username}</div><div>${e.rating} ‚òÖ</div>`;
        container.appendChild(div);
      });
    }

    function setProfileUI() {
      document.getElementById("user-name").innerText = profile.username;
      document.getElementById("user-id").innerText = `ID: ${profile.user_id}`;
      document.getElementById("prestige-badge").innerText = `x${profile.prestige_multiplier.toFixed(2)}`;
      document.getElementById("title-badge").innerText = profile.title;
      document.getElementById("star-count").innerText = profile.stars;
      // rows
      const stats = document.getElementById("profile-stats");
      stats.innerHTML = "";
      const rows = [
        ["–†–µ–π—Ç–∏–Ω–≥", profile.rating + " ‚òÖ"],
        ["–°—Ç—Ä–∏–∫", profile.streak + " –¥–Ω."],
        ["–ü—Ä–µ—Å—Ç–∏–∂ —É—Ä–æ–≤–µ–Ω—å", profile.prestige_level],
        ["–°–ª–µ–¥—É—é—â–∏–π /daily", profile.last_daily ? new Date(profile.last_daily).toLocaleString() : "‚Äî"],
      ];
      rows.forEach(([k,v])=>{
        const r = document.createElement("div");
        r.className = "row";
        r.innerHTML = `<div>${k}</div><div>${v}</div>`;
        stats.appendChild(r);
      });
    }

    function getInitDataStr() {
      if (isTelegram) {
        return window.Telegram.WebApp.initData || "";
      }
      // –∫–∞–∫ fallback: –∏–∑ query param
      const params = new URLSearchParams(window.location.search);
      return params.get("init_data") || "";
    }

    async function syncProfile() {
      const init_data = getInitDataStr();
      const chat_id = new URLSearchParams(window.location.search).get("chat_id") || 0;
      if (!API_BASE) {
        // offline fallback: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        const saved = JSON.parse(localStorage.getItem("sr_offline_profile") || "{}");
        if (saved.user_id) profile = {...profile, ...saved};
        setProfileUI();
        updateLocalLeaderboard();
        return;
      }
      try {
        const resp = await fetch(`${API_BASE}/api/profile`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ init_data, chat_id: Number(chat_id) })
        });
        const data = await resp.json();
        if (data.ok) {
          Object.assign(profile, {
            user_id: data.user.user_id,
            username: data.user.username,
            rating: data.user.rating,
            title: data.user.title,
            streak: data.user.streak,
            prestige_multiplier: data.user.prestige_multiplier,
            prestige_level: data.user.prestige_level,
            stars: data.user.stars,
            last_daily: data.user.next_daily_available_in === 0 ? new Date().toISOString() : profile.last_daily
          });
          setProfileUI();
          updateLocalLeaderboard();
        } else {
          toast("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å.");
        }
      } catch (e) {
        console.warn(e);
        toast("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API, –∏–≥—Ä–∞ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ.");
        // –ª–æ–∫–∞–ª—å–Ω–æ
        const saved = JSON.parse(localStorage.getItem("sr_offline_profile") || "{}");
        if (saved.user_id) profile = {...profile, ...saved};
        setProfileUI();
        updateLocalLeaderboard();
      }
    }

    async function doDaily() {
      const init_data = getInitDataStr();
      const chat_id = new URLSearchParams(window.location.search).get("chat_id") || 0;
      if (!API_BASE) {
        toast("–û—Ñ—Ñ–ª–∞–π–Ω: /daily —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ.");
        // –ª–æ–∫–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)
        const now = Date.now();
        const last = profile.last_daily ? new Date(profile.last_daily).getTime() : 0;
        if (now - last < 24*3600*1000) {
          toast("–£–∂–µ –¥–µ–ª–∞–ª /daily, –ø–æ–¥–æ–∂–¥–∏.");
          return;
        }
        const delta = Math.floor((Math.random()*21 - 10) * profile.prestige_multiplier);
        profile.rating = Math.max(0, profile.rating + delta);
        profile.streak = profile.last_daily && now - last < 48*3600*1000 ? profile.streak + 1 : 1;
        profile.last_daily = new Date().toISOString();
        localStorage.setItem("sr_offline_profile", JSON.stringify(profile));
        setProfileUI();
        updateLocalLeaderboard();
        toast(`${delta >= 0 ? "+" : ""}${delta} —Ä–µ–π—Ç–∏–Ω–≥–∞`);
        return;
      }
      try {
        const resp = await fetch(`${API_BASE}/api/daily`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ init_data, chat_id: Number(chat_id) })
        });
        const data = await resp.json();
        if (data.ok) {
          profile.rating = data.user.rating;
          profile.streak = data.daily.streak;
          profile.prestige_multiplier = data.user.prestige_multiplier;
          profile.prestige_level = data.user.prestige_level;
          profile.stars = data.user.stars || profile.stars;
          setProfileUI();
          updateLocalLeaderboard();
          toast(`Œî ${data.daily.delta} —Ä–µ–π—Ç–∏–Ω–≥–∞`);
        } else {
          toast("–ù–µ–ª—å–∑—è /daily: " + (data.error || "–æ—Ö —É–∂"));
        }
      } catch (e) {
        console.warn(e);
        toast("–û—à–∏–±–∫–∞ /daily");
      }
    }

    async function spinWheel() {
      const init_data = getInitDataStr();
      const chat_id = new URLSearchParams(window.location.search).get("chat_id") || 0;
      if (!API_BASE) {
        // –ª–æ–∫–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
        const prizes = ["+50", "+1‚≠ê", "x1.1", "–Ω–∏—á–µ–≥–æ", "+100", "+2‚≠ê"];
        const pick = prizes[Math.floor(Math.random()*prizes.length)];
        if (pick.includes("50")) profile.rating += 50;
        if (pick.includes("100")) profile.rating += 100;
        if (pick.includes("‚≠ê")) profile.stars += parseInt(pick.replace(/\D/g,"")) || 1;
        if (pick.includes("x1.1")) profile.prestige_multiplier *= 1.1;
        setProfileUI();
        updateLocalLeaderboard();
        toast("–ö–æ–ª–µ—Å–æ: " + pick);
        document.getElementById("wheel-result").innerText = "–í—ã–ø–∞–ª–æ: " + pick;
        return;
      }
      try {
        const resp = await fetch(`${API_BASE}/api/wheel`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ init_data, chat_id: Number(chat_id) })
        });
        const data = await resp.json();
        if (data.ok) {
          profile.rating = data.user.rating;
          profile.prestige_multiplier = data.user.prestige_multiplier;
          profile.stars = data.user.stars;
          setProfileUI();
          updateLocalLeaderboard();
          toast("–ö–æ–ª–µ—Å–æ: " + data.result);
          document.getElementById("wheel-result").innerText = "–í—ã–ø–∞–ª–æ: " + data.result;
        }
      } catch (e) {
        console.warn(e);
        toast("–û—à–∏–±–∫–∞ –∫–æ–ª–µ—Å–∞");
      }
    }

    async function spinSlot() {
      const init_data = getInitDataStr();
      const chat_id = new URLSearchParams(window.location.search).get("chat_id") || 0;
      if (!API_BASE) {
        // –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–ª–æ—Ç-–ø—Ä–∏–º–µ—Ä
        const symbols = ["üçí","üçã","üîî","‚≠ê","7Ô∏è‚É£"];
        const a = symbols[Math.floor(Math.random()*symbols.length)];
        const b = symbols[Math.floor(Math.random()*symbols.length)];
        const c = symbols[Math.floor(Math.random()*symbols.length)];
        document.getElementById("r1").innerText = a;
        document.getElementById("r2").innerText = b;
        document.getElementById("r3").innerText = c;
        let payout = 0;
        if (a===b && b===c) payout = 200;
        else if (a===b || b===c || a===c) payout = 50;
        profile.rating += payout;
        setProfileUI();
        updateLocalLeaderboard();
        document.getElementById("slot-result").innerText = payout > 0 ? `–í—ã–∏–≥—Ä—ã—à +${payout}` : "–ù–∏—á–µ–≥–æ";
        toast("–°–ª–æ—Ç: " + (payout>0 ? `+${payout}` : "–ø—É—Å—Ç–æ"));
        return;
      }
      try {
        const resp = await fetch(`${API_BASE}/api/slot`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ init_data, chat_id: Number(chat_id) })
        });
        const data = await resp.json();
        if (data.ok) {
          document.getElementById("r1").innerText = data.reels[0];
          document.getElementById("r2").innerText = data.reels[1];
          document.getElementById("r3").innerText = data.reels[2];
          profile.rating = data.user.rating;
          setProfileUI();
          updateLocalLeaderboard();
          document.getElementById("slot-result").innerText = data.payout > 0 ? `–í—ã–∏–≥—Ä—ã—à +${data.payout}` : "–ù–∏—á–µ–≥–æ";
          toast("–°–ª–æ—Ç: " + (data.payout>0 ? `+${data.payout}` : "–ø—É—Å—Ç–æ"));
        }
      } catch (e) {
        console.warn(e);
        toast("–û—à–∏–±–∫–∞ —Å–ª–æ—Ç–∞");
      }
    }

    // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    document.getElementById("daily-btn").addEventListener("click", async ()=>{
      await doDaily();
      document.getElementById("profile-card").classList.add("pulse");
      setTimeout(()=> document.getElementById("profile-card").classList.remove("pulse"), 500);
    });
    document.getElementById("prestige-btn").addEventListener("click", ()=>{
      if (profile.rating < 1000) {
        toast("–ù—É–∂–Ω–æ ‚â•1000 —Ä–µ–π—Ç–∏–Ω–≥–∞");
        return;
      }
      profile.prestige_level += 1;
      profile.prestige_multiplier += 0.1;
      profile.rating = 100;
      toast("–ü—Ä–µ—Å—Ç–∏–∂: x" + profile.prestige_multiplier.toFixed(2));
      setProfileUI();
      updateLocalLeaderboard();
    });
    document.getElementById("refresh-btn").addEventListener("click", syncProfile);
    document.getElementById("spin-wheel").addEventListener("click", spinWheel);
    document.getElementById("spin-slot").addEventListener("click", spinSlot);
    document.getElementById("clear-lb").addEventListener("click", ()=>{
      localStorage.removeItem(LB_KEY);
      renderLeaderboard();
    });

    // init
    (async ()=>{
      if (isTelegram) {
        const user = window.Telegram.WebApp.initDataUnsafe?.user;
        if (user) {
          profile.username = user.username || `${user.first_name || ""} ${user.last_name || ""}`.trim();
          profile.user_id = user.id;
        }
      }
      await syncProfile();
    })();
  </script>
</body>
</html>
